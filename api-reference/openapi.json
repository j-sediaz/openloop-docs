{
  "openapi": "3.1.0",
  "info": {
    "title": "Partners API",
    "description": "Partners API v1 - Clinical workflow management including patients, orders, labs, and documents.",
    "version": "1.1.0"
  },
  "servers": [
    {
      "url": "https://api-staging.openloophealth.com",
      "description": "Staging server"
    }
  ],
  "security": [
    {
      "apiKeyAuth": []
    },
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "System",
      "description": "Health check endpoint"
    },
    {
      "name": "Programs",
      "description": "✅ MVP - Available programs and their questionnaires (currently: Medical Weight Loss)"
    },
    {
      "name": "Questionnaires (MVP)",
      "description": "✅ MVP - Submit and retrieve patient questionnaire responses for MWL"
    },
    {
      "name": "Patients (MVP)",
      "description": "✅ MVP - Patient management for Medical Weight Loss program"
    },
    {
      "name": "Products (MVP)",
      "description": "✅ MVP - MWL product catalog (Semaglutide & Tirzepatide - Oral/Injection, 4/12/24/48 week supplies)"
    },
    {
      "name": "Orders (MVP)",
      "description": "✅ MVP - Order management for MWL subscriptions"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "operationId": "getHealth",
        "summary": "Health Check",
        "description": "Health check endpoint",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Service health information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["name", "version_date"],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "version_date": {
                      "type": "string",
                      "format": "date-time",
                      "description": "Version date in ISO 8601 format"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Health check response",
                    "value": {
                      "name": "partners-api",
                      "version_date": "2025-11-21T16:51:50.139Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/patients": {
      "get": {
        "operationId": "listPatients",
        "summary": "List Patients",
        "description": "List all patients with optional filtering and pagination",
        "tags": ["Patients (MVP)"],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Search query to filter patients by email, firstName, lastName, or phone",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of patients",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "createPatient",
        "summary": "Create Patient",
        "description": "Create a new patient",
        "tags": ["Patients (MVP)"],
        "requestBody": {
          "description": "Patient data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PatientInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Patient created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Validation error or invalid data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "validation_error": {
                    "summary": "Validation Error",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/patients/{id}": {
      "get": {
        "operationId": "getPatient",
        "summary": "Get Patient",
        "description": "Get a specific patient by ID",
        "tags": ["Patients (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Patient found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Patient does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "not_found": {
                    "summary": "Patient Not Found",
                    "value": {
                      "error": "NotFound",
                      "message": "Resource not found"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "patch": {
        "operationId": "updatePatient",
        "summary": "Update Patient",
        "description": "Update patient information (partial updates supported)",
        "tags": ["Patients (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Updated patient data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PatientInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Patient updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Patient does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "not_found": {
                    "summary": "Patient Not Found",
                    "value": {
                      "error": "NotFound",
                      "message": "Resource not found"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "operationId": "deletePatient",
        "summary": "Delete Patient",
        "description": "Delete a patient",
        "tags": ["Patients (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Patient deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/questionnaires": {
      "get": {
        "operationId": "listQuestionnaires",
        "summary": "List Questionnaires",
        "description": "Get questionnaires for a program. Use this to retrieve the questionnaire structure before collecting patient responses.",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "program_id",
            "in": "query",
            "description": "Filter by program ID (e.g., MWL)",
            "required": true,
            "schema": {
              "type": "string",
              "example": "MWL"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by questionnaire type",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["intake", "refill"],
              "example": "intake"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Questionnaires retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionnaireListResponse"
                },
                "examples": {
                  "mwl_intake": {
                    "summary": "MWL Intake Questionnaire",
                    "value": {
                      "message": "Questionnaires retrieved successfully",
                      "data": {
                        "questionnaires": [
                          {
                            "id": "q_mwl_intake_v1",
                            "program_id": "MWL",
                            "type": "intake",
                            "title": "Medical Weight Loss - Initial Assessment",
                            "description": "Initial intake questionnaire for Medical Weight Loss program",
                            "items": [
                              {
                                "link_id": "weight_goal",
                                "text": "What is your weight loss goal?",
                                "type": "choice",
                                "required": true,
                                "read_only": false,
                                "answer_options": [
                                  {
                                    "value_coding": {
                                      "code": "lose_1-20_lbs",
                                      "display": "Lose 1-20 lbs for good"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "lose_21-50_lbs",
                                      "display": "Lose 21-50 lbs for good"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "lose_over_50_lbs",
                                      "display": "Lose over 50 lbs for good"
                                    }
                                  }
                                ]
                              },
                              {
                                "link_id": "height_feet",
                                "text": "What is your height (feet)?",
                                "type": "integer",
                                "required": true,
                                "read_only": false
                              },
                              {
                                "link_id": "height_inches",
                                "text": "What is your height (inches)?",
                                "type": "integer",
                                "required": true,
                                "read_only": false
                              },
                              {
                                "link_id": "weight",
                                "text": "What is your current weight (lbs)?",
                                "type": "integer",
                                "required": true,
                                "read_only": false
                              },
                              {
                                "link_id": "bmi",
                                "text": "BMI (calculated)",
                                "type": "decimal",
                                "required": true,
                                "read_only": true
                              },
                              {
                                "link_id": "gender",
                                "text": "What is your gender?",
                                "type": "choice",
                                "required": true,
                                "read_only": false,
                                "answer_options": [
                                  {
                                    "value_coding": {
                                      "code": "male",
                                      "display": "Male"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "female",
                                      "display": "Female"
                                    }
                                  }
                                ]
                              },
                              {
                                "link_id": "date_of_birth",
                                "text": "What is your date of birth?",
                                "type": "date",
                                "required": true,
                                "read_only": false
                              },
                              {
                                "link_id": "medical_exclusion_criteria",
                                "text": "Do any of the following apply to you?",
                                "type": "choice",
                                "required": true,
                                "read_only": false,
                                "answer_options": [
                                  {
                                    "value_coding": {
                                      "code": "none",
                                      "display": "None of the below"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "pregnant",
                                      "display": "Currently or possibly pregnant"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "kidney_disease",
                                      "display": "End-stage kidney disease"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "pancreatitis",
                                      "display": "History of or current pancreatitis"
                                    }
                                  }
                                ]
                              },
                              {
                                "link_id": "medication_allergies",
                                "text": "Do you have any medication allergies?",
                                "type": "choice",
                                "required": true,
                                "read_only": false,
                                "answer_options": [
                                  {
                                    "value_coding": {
                                      "code": "yes",
                                      "display": "Yes"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "no",
                                      "display": "No"
                                    }
                                  }
                                ]
                              },
                              {
                                "link_id": "allergy_medication_description",
                                "text": "Please provide details including name and reaction",
                                "type": "string",
                                "required": true,
                                "read_only": false,
                                "enabled_when": {
                                  "conditions": [
                                    {
                                      "question_link_id": "medication_allergies",
                                      "operator": "=",
                                      "answer": {
                                        "value_string": "yes"
                                      }
                                    }
                                  ],
                                  "behavior": "all"
                                }
                              },
                              {
                                "link_id": "blood_pressure_range",
                                "text": "What is your current or average blood pressure range?",
                                "type": "choice",
                                "required": true,
                                "read_only": false,
                                "answer_options": [
                                  {
                                    "value_coding": {
                                      "code": "normal",
                                      "display": "<120/80 (Normal)"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "elevated",
                                      "display": "120-129/<80 (Elevated)"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "high_stage1",
                                      "display": "130-139/80-89 (High Stage 1)"
                                    }
                                  },
                                  {
                                    "value_coding": {
                                      "code": "high_stage2",
                                      "display": "≥140/90 (High Stage 2)"
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/questionnaire-responses": {
      "post": {
        "operationId": "submitQuestionnaireResponse",
        "summary": "Submit Questionnaire Response",
        "description": "Submit a completed questionnaire response for a patient",
        "tags": ["Questionnaires (MVP)"],
        "requestBody": {
          "description": "Questionnaire response data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/QuestionnaireResponseInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Questionnaire response submitted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionnaireResponseSubmitResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Response submitted",
                    "value": {
                      "message": "Questionnaire response submitted successfully",
                      "data": {
                        "questionnaire_response": {
                          "id": "qr_abc123",
                          "patient_id": "pat_xyz789",
                          "questionnaire_id": "q_mwl_intake_v1",
                          "program_id": "MWL",
                          "status": "completed",
                          "answers": {
                            "weight_goal": "lose_21-50_lbs",
                            "height_feet": 5,
                            "height_inches": 5,
                            "weight": 160,
                            "gender": "female",
                            "date_of_birth": "1990-01-01",
                            "state": "AL",
                            "main_reason": "health_risks",
                            "medical_exclusion_criteria": ["none"],
                            "prior_weight_loss_meds_use": "no",
                            "any_medications": "no",
                            "medication_allergies": "no",
                            "blood_pressure_range": "normal"
                          },
                          "risk_assessment": {
                            "eligible": true,
                            "risk_level": "low",
                            "requires_sync_consult": false,
                            "requires_clearance": false,
                            "exclusion_reason": null,
                            "sync_visit_reason": null,
                            "next_step": "allow_async_order"
                          },
                          "calculated_fields": {
                            "bmi": 26.62,
                            "age": 35,
                            "height": 65,
                            "comorbidity_required": true
                          },
                          "completed_at": "2025-01-15T14:30:00Z",
                          "created_at": "2025-01-15T14:25:00Z"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "get": {
        "operationId": "listQuestionnaireResponses",
        "summary": "List Questionnaire Responses",
        "description": "Retrieve questionnaire responses with optional filtering",
        "tags": ["Questionnaires (MVP)"],
        "parameters": [
          {
            "name": "patient_id",
            "in": "query",
            "description": "Filter by patient ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "questionnaire_id",
            "in": "query",
            "description": "Filter by questionnaire ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "program_id",
            "in": "query",
            "description": "Filter by program ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Questionnaire responses retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionnaireResponseListResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/questionnaire-responses/{id}": {
      "get": {
        "operationId": "getQuestionnaireResponse",
        "summary": "Get Questionnaire Response",
        "description": "Retrieve a specific questionnaire response",
        "tags": ["Questionnaires (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Questionnaire Response ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Questionnaire response retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionnaireResponseSubmitResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/programs": {
      "get": {
        "operationId": "listPrograms",
        "summary": "List Programs",
        "description": "Get all available programs. Currently supports: Medical Weight Loss (MWL) - GLP-1 medications for weight management.",
        "tags": ["Programs"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "Programs retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgramListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Programs list example",
                    "value": {
                      "message": "Programs retrieved successfully",
                      "data": {
                        "programs": [
                          {
                            "id": "MWL",
                            "name": "Medical Weight Loss",
                            "description": "Personalized weight loss program with GLP-1 medications (Semaglutide and Tirzepatide)",
                            "eligibility": {
                              "age_range": "18-65",
                              "gender": null
                            }
                          }
                        ]
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/programs/{programId}": {
      "get": {
        "operationId": "getProgram",
        "summary": "Get Program",
        "description": "Retrieve program details. MVP supports: MWL (Medical Weight Loss)",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "programId",
            "in": "path",
            "description": "Program abbreviation (e.g., ADHD, MHL, ED)",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Program retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgramResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Program example",
                    "value": {
                      "message": "Program retrieved successfully",
                      "data": {
                        "program": {
                          "id": "MWL",
                          "name": "Medical Weight Loss",
                          "description": "Personalized weight loss program with GLP-1 medications (Semaglutide and Tirzepatide)",
                          "eligibility": {
                            "age_range": "18-65",
                            "gender": null
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/products": {
      "get": {
        "operationId": "listProducts",
        "summary": "List Products",
        "description": "Get all available products with optional filtering by program, payment provider, or client",
        "tags": ["Products (MVP)"],
        "parameters": [
          {
            "name": "program_id",
            "in": "query",
            "description": "Filter by program abbreviation (ADHD, MHL, ED, etc.)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "payment_provider",
            "in": "query",
            "description": "Filter by payment provider",
            "schema": {
              "type": "string",
              "enum": ["stripe", "chargebee"]
            }
          },
          {
            "name": "active",
            "in": "query",
            "description": "Filter by active status",
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Products retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Products list example",
                    "value": {
                      "message": "Products retrieved successfully",
                      "data": {
                        "products": [
                          {
                            "id": "sem_w12",
                            "name": "Semaglutide Injection",
                            "description": "12-week supply of injectable Semaglutide for weight management",
                            "program_id": "MWL",
                            "price": 399.00,
                            "currency": "USD",
                            "subscription": {
                              "is_recurring": true,
                              "interval_days": 84,
                              "interval_label": "every 12 weeks"
                            },
                            "active": true
                          },
                          {
                            "id": "osg_w04",
                            "name": "Semaglutide Oral",
                            "description": "4-week supply of oral Semaglutide for weight management",
                            "program_id": "MWL",
                            "price": 149.00,
                            "currency": "USD",
                            "subscription": {
                              "is_recurring": true,
                              "interval_days": 28,
                              "interval_label": "every 4 weeks"
                            },
                            "active": true
                          },
                          {
                            "id": "ter_w24",
                            "name": "Tirzepatide Injection",
                            "description": "24-week supply of injectable Tirzepatide for weight management",
                            "program_id": "MWL",
                            "price": 899.00,
                            "currency": "USD",
                            "subscription": {
                              "is_recurring": true,
                              "interval_days": 168,
                              "interval_label": "every 24 weeks"
                            },
                            "active": true
                          }
                        ],
                        "pagination": {
                          "total": 16,
                          "limit": 50,
                          "offset": 0,
                          "has_more": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/orders": {
      "get": {
        "operationId": "listOrders",
        "summary": "List Orders",
        "description": "Retrieve all orders with optional filtering",
        "tags": ["Orders (MVP)"],
        "parameters": [
          {
            "name": "patient_id",
            "in": "query",
            "description": "Filter by patient ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "product_id",
            "in": "query",
            "description": "Filter by product ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by order status",
            "schema": {
              "type": "string",
              "enum": ["pending", "confirmed", "completed", "cancelled"]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Orders retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Orders list",
                    "value": {
                      "message": "Orders retrieved successfully",
                      "data": {
                        "orders": [
                          {
                            "id": "ord_abc123",
                            "patient_id": "pat_xyz789",
                            "program_id": "MWL",
                            "product_id": "sem_w12",
                            "status": "confirmed",
                            "total_amount": 39900,
                            "created_at": "2024-12-02T10:30:00Z"
                          }
                        ],
                        "pagination": {
                          "total": 1,
                          "limit": 50,
                          "offset": 0,
                          "has_more": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "post": {
        "operationId": "createOrder",
        "summary": "Create Order",
        "description": "Create a new order based on patient, product, and questionnaire",
        "tags": ["Orders (MVP)"],
        "requestBody": {
          "description": "Order data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Order created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Order created",
                    "value": {
                      "message": "Order created successfully",
                      "data": {
                        "order": {
                          "id": "ord_abc123",
                          "patient_id": "pat_xyz789",
                          "program_id": "MWL",
                          "product_id": "sem_w12",
                          "status": "pending",
                          "total_amount": 39900,
                          "created_at": "2024-12-02T10:30:00Z"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/orders/{id}": {
      "get": {
        "operationId": "getOrder",
        "summary": "Get Order",
        "description": "Retrieve a specific order by ID",
        "tags": ["Orders (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "patch": {
        "operationId": "updateOrder",
        "summary": "Update Order",
        "description": "Update an existing order including fulfillment, review, and other fields",
        "tags": ["Orders (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Updated order data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderUpdateInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Order updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "delete": {
        "operationId": "deleteOrder",
        "summary": "Delete Order",
        "description": "Delete an order by ID",
        "tags": ["Orders (MVP)"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Order deleted successfully"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Patient": {
        "type": "object",
        "required": [
          "id",
          "email",
          "first_name",
          "last_name",
          "phone",
          "birth_date",
          "sex"
        ],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique patient identifier"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Patient's email address",
            "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          },
          "first_name": {
            "type": "string",
            "description": "Patient's first name",
            "minLength": 1
          },
          "middle_name": {
            "type": "string",
            "nullable": true,
            "description": "Patient's middle name"
          },
          "last_name": {
            "type": "string",
            "description": "Patient's last name",
            "minLength": 1
          },
          "phone": {
            "type": "string",
            "description": "Patient's phone number",
            "pattern": "^[\\d\\s\\-\\(\\)\\+]+$",
            "minLength": 5
          },
          "birth_date": {
            "type": "string",
            "format": "date",
            "description": "Patient's birth date in YYYY-MM-DD format",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "enum": ["male", "female", "other"],
            "description": "Patient's gender identity"
          },
          "sex": {
            "type": "string",
            "enum": ["male", "female", "other", "unknown"],
            "description": "Patient's biological sex"
          },
          "preferred_language": {
            "type": "string",
            "nullable": true,
            "description": "Patient's preferred language"
          },
          "locations": {
            "type": "array",
            "nullable": true,
            "items": {
              "$ref": "#/components/schemas/Location"
            },
            "description": "Patient's addresses"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Tag"
            },
            "description": "Patient tags for categorization"
          }
        },
        "example": {
          "id": "pat_1a2b3c4d5e6f",
          "email": "john.doe@example.com",
          "first_name": "John",
          "middle_name": "Michael",
          "last_name": "Doe",
          "phone": "+1-555-0123",
          "birth_date": "1990-05-15",
          "gender": "male",
          "sex": "male",
          "preferred_language": "en",
          "locations": [
            {
              "address_line_1": "123 Main Street",
              "address_line_2": "Apt 4B",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }
          ],
          "tags": [
            {
              "type": "employer",
              "name": "TechCorp"
            }
          ]
        }
      },
      "PatientInput": {
        "type": "object",
        "required": [
          "email",
          "first_name",
          "last_name",
          "phone",
          "birth_date",
          "gender",
          "sex",
          "locations"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Patient's email address",
            "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          },
          "first_name": {
            "type": "string",
            "description": "Patient's first name",
            "minLength": 1
          },
          "middle_name": {
            "type": "string",
            "nullable": true,
            "description": "Patient's middle name"
          },
          "last_name": {
            "type": "string",
            "description": "Patient's last name",
            "minLength": 1
          },
          "phone": {
            "type": "string",
            "description": "Patient's phone number",
            "pattern": "^[\\d\\s\\-\\(\\)\\+]+$",
            "minLength": 5
          },
          "birth_date": {
            "type": "string",
            "format": "date",
            "description": "Patient's birth date in YYYY-MM-DD format",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "enum": ["male", "female", "other"],
            "description": "Patient's gender identity"
          },
          "sex": {
            "type": "string",
            "enum": ["male", "female", "other", "unknown"],
            "description": "Patient's biological sex"
          },
          "preferred_language": {
            "type": "string",
            "nullable": true,
            "description": "Patient's preferred language"
          },
          "locations": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/components/schemas/Location"
            },
            "description": "Patient's addresses"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Tag"
            },
            "description": "Patient tags for categorization"
          }
        },
        "example": {
          "email": "john.doe@example.com",
          "first_name": "John",
          "middle_name": "Michael",
          "last_name": "Doe",
          "phone": "+1-555-0123",
          "birth_date": "1990-05-15",
          "gender": "male",
          "sex": "male",
          "preferred_language": "en",
          "locations": [
            {
              "address_line_1": "123 Main Street",
              "address_line_2": "Apt 4B",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }
          ],
          "tags": [
            {
              "type": "employer",
              "name": "TechCorp"
            }
          ]
        }
      },
      "Location": {
        "type": "object",
        "required": [
          "address_line_1",
          "city",
          "state",
          "country",
          "zip_code",
          "default",
          "type"
        ],
        "properties": {
          "address_line_1": {
            "type": "string",
            "description": "Primary address line",
            "minLength": 1
          },
          "address_line_2": {
            "type": "string",
            "nullable": true,
            "description": "Secondary address line"
          },
          "city": {
            "type": "string",
            "description": "City name",
            "minLength": 1
          },
          "state": {
            "type": "string",
            "description": "State or province",
            "minLength": 1
          },
          "country": {
            "type": "string",
            "description": "Country code (2 letters)",
            "minLength": 2,
            "maxLength": 2
          },
          "zip_code": {
            "type": "string",
            "description": "ZIP or postal code",
            "minLength": 1
          },
          "default": {
            "type": "boolean",
            "description": "Whether this is the default address"
          },
          "type": {
            "type": "string",
            "enum": ["home", "work"],
            "description": "Type of address"
          }
        },
        "example": {
          "address_line_1": "123 Main Street",
          "address_line_2": "Apt 4B",
          "city": "New York",
          "state": "NY",
          "country": "US",
          "zip_code": "10001",
          "default": true,
          "type": "home"
        }
      },
      "Tag": {
        "type": "object",
        "required": [
          "type",
          "name"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["employer", "operational"],
            "description": "Type of tag"
          },
          "name": {
            "type": "string",
            "description": "Tag name",
            "minLength": 1
          }
        },
        "example": {
          "type": "employer",
          "name": "TechCorp"
        }
      },
      "Error": {
        "type": "object",
        "required": [
          "error",
          "message"
        ],
        "properties": {
          "error": {
            "type": "string",
            "description": "Error code",
            "enum": [
              "BadRequest",
              "Unauthorized",
              "Forbidden",
              "NotFound",
              "ValidationError",
              "InternalServerError",
              "ServiceUnavailable"
            ],
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error message",
            "example": "Invalid input data"
          },
          "details": {
            "type": "array",
            "description": "Array of validation error details",
            "items": {
              "type": "object",
              "required": [
                "field",
                "issue"
              ],
              "properties": {
                "field": {
                  "type": "string",
                  "description": "Field that caused the validation error",
                  "example": "email"
                },
                "issue": {
                  "type": "string",
                  "description": "Description of the validation issue",
                  "example": "Invalid email format"
                }
              }
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "required": [
          "total",
          "limit",
          "offset",
          "has_more"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "description": "Total number of items matching the query",
            "example": 13
          },
          "limit": {
            "type": "integer",
            "description": "Maximum number of items returned per page",
            "example": 10
          },
          "offset": {
            "type": "integer",
            "description": "Number of items skipped",
            "example": 0
          },
          "has_more": {
            "type": "boolean",
            "description": "Whether there are more items available",
            "example": true
          }
        }
      },
      "PatientListResponse": {
        "type": "object",
        "required": [
          "message",
          "data"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message",
            "example": "Patients retrieved successfully"
          },
          "data": {
            "type": "object",
            "required": [
              "patients",
              "pagination"
            ],
            "properties": {
              "patients": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Patient"
                },
                "description": "Array of patient objects"
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        },
        "example": {
          "message": "Patients retrieved successfully",
          "data": {
            "patients": [
              {
                "id": "pat_1a2b3c4d5e6f",
                "email": "john.doe@example.com",
                "first_name": "John",
                "middle_name": "Michael",
                "last_name": "Doe",
                "phone": "+1-555-0123",
                "birth_date": "1990-05-15",
                "gender": "male",
                "sex": "male",
                "preferred_language": "en",
                "locations": [
                  {
                    "address_line_1": "123 Main Street",
                    "address_line_2": "Apt 4B",
                    "city": "New York",
                    "state": "NY",
                    "country": "US",
                    "zip_code": "10001",
                    "default": true,
                    "type": "home"
                  }
                ],
                "tags": [
                  {
                    "type": "employer",
                    "name": "TechCorp"
                  }
                ]
              }
            ],
            "pagination": {
              "total": 1,
              "limit": 50,
              "offset": 0,
              "has_more": false
            }
          }
        }
      },
      "PatientResponse": {
        "type": "object",
        "required": [
          "message",
          "data"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message",
            "example": "Patient created successfully"
          },
          "data": {
            "type": "object",
            "required": [
              "patient"
            ],
            "properties": {
              "patient": {
                "$ref": "#/components/schemas/Patient"
              }
            }
          }
        },
        "example": {
          "message": "Patient created successfully",
          "data": {
            "patient": {
              "id": "pat_1a2b3c4d5e6f",
              "email": "john.doe@example.com",
              "first_name": "John",
              "middle_name": "Michael",
              "last_name": "Doe",
              "phone": "+1-555-0123",
              "birth_date": "1990-05-15",
              "gender": "male",
              "sex": "male",
              "preferred_language": "en",
              "locations": [
                {
                  "address_line_1": "123 Main Street",
                  "address_line_2": "Apt 4B",
                  "city": "New York",
                  "state": "NY",
                  "country": "US",
                  "zip_code": "10001",
                  "default": true,
                  "type": "home"
                }
              ],
              "tags": [
                {
                  "type": "employer",
                  "name": "TechCorp"
                }
              ]
            }
          }
        }
      },
      "Program": {
        "type": "object",
        "required": ["id", "name", "description"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Program unique identifier (use this when filtering products or creating orders)",
            "example": "MWL"
          },
          "name": {
            "type": "string",
            "description": "Program display name",
            "example": "Medical Weight Loss"
          },
          "description": {
            "type": "string",
            "description": "Program description",
            "example": "Personalized weight loss program with GLP-1 medications (Semaglutide and Tirzepatide)"
          },
          "eligibility": {
            "type": "object",
            "description": "Program eligibility criteria",
            "properties": {
              "age_range": {
                "type": "string",
                "nullable": true,
                "description": "Target age range (e.g., '18-65'). Null means no age restriction.",
                "example": "18-65"
              },
              "gender": {
                "type": "string",
                "nullable": true,
                "enum": ["M", "F", null],
                "description": "Gender restriction: M (Male only), F (Female only), null (no restriction)",
                "example": null
              }
            }
          }
        },
        "example": {
          "id": "MWL",
          "name": "Medical Weight Loss",
          "description": "Personalized weight loss program with GLP-1 medications (Semaglutide and Tirzepatide)",
          "eligibility": {
            "age_range": "18-65",
            "gender": null
          }
        }
      },
      "ProgramListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["programs"],
            "properties": {
              "programs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Program"
                },
                "description": "List of available programs"
              }
            }
          }
        }
      },
      "ProgramResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["program"],
            "properties": {
              "program": {
                "$ref": "#/components/schemas/Program"
              }
            }
          }
        }
      },
      "QuestionnaireItem": {
        "type": "object",
        "required": ["link_id", "text", "type", "required", "read_only"],
        "properties": {
          "link_id": {
            "type": "string",
            "description": "Unique identifier for this question",
            "example": "weight_goal"
          },
          "text": {
            "type": "string",
            "description": "Question text displayed to user",
            "example": "What is your weight loss goal?"
          },
          "type": {
            "type": "string",
            "enum": ["choice", "string", "decimal", "integer", "date", "boolean"],
            "description": "Question type"
          },
          "required": {
            "type": "boolean",
            "description": "Whether the question is required"
          },
          "read_only": {
            "type": "boolean",
            "description": "If true, this field is calculated internally and should not be submitted by the user"
          },
          "answer_options": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AnswerOption"
            },
            "description": "Available options for choice questions"
          },
          "enabled_when": {
            "$ref": "#/components/schemas/EnabledWhen"
          }
        }
      },
      "AnswerOption": {
        "type": "object",
        "properties": {
          "value_coding": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "Option code",
                "example": "lose_21-50_lbs"
              },
              "display": {
                "type": "string",
                "description": "Option display text",
                "example": "Lose 21-50 lbs for good"
              },
              "olh_concept_id": {
                "type": "string",
                "description": "Internal concept ID"
              }
            }
          }
        }
      },
      "EnabledWhen": {
        "type": "object",
        "description": "Conditional logic for displaying questions",
        "properties": {
          "conditions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "question_link_id": {
                  "type": "string",
                  "description": "The question this condition depends on"
                },
                "operator": {
                  "type": "string",
                  "enum": ["=", "!=", ">", "<", ">=", "<="],
                  "description": "Comparison operator"
                },
                "answer": {
                  "type": "object",
                  "description": "The answer value to compare against"
                }
              }
            }
          },
          "behavior": {
            "type": "string",
            "enum": ["all", "any"],
            "description": "Whether all or any conditions must be met"
          }
        }
      },
      "Questionnaire": {
        "type": "object",
        "required": ["id", "program_id", "type", "title", "items"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Questionnaire unique identifier",
            "example": "q_mwl_intake_v1"
          },
          "program_id": {
            "type": "string",
            "description": "Associated program ID",
            "example": "MWL"
          },
          "type": {
            "type": "string",
            "enum": ["intake", "refill"],
            "description": "Questionnaire type"
          },
          "title": {
            "type": "string",
            "description": "Questionnaire title",
            "example": "Medical Weight Loss - Initial Assessment"
          },
          "description": {
            "type": "string",
            "description": "Questionnaire description"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QuestionnaireItem"
            },
            "description": "List of questionnaire items (questions)"
          }
        }
      },
      "QuestionnaireListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "required": ["questionnaires"],
            "properties": {
              "questionnaires": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Questionnaire"
                }
              }
            }
          }
        }
      },
      "QuestionnaireResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["questionnaire"],
            "properties": {
              "questionnaire": {
                "$ref": "#/components/schemas/Questionnaire"
              }
            }
          }
        }
      },
      "Product": {
        "type": "object",
        "required": ["id", "name", "description", "price", "currency", "program_id"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique product identifier (use this when creating orders)",
            "example": "sem_w12"
          },
          "name": {
            "type": "string",
            "description": "Product display name",
            "example": "Semaglutide Injection"
          },
          "description": {
            "type": "string",
            "description": "Product description",
            "example": "12-week supply of injectable Semaglutide for weight management"
          },
          "program_id": {
            "type": "string",
            "description": "Associated program ID",
            "example": "MWL"
          },
          "price": {
            "type": "number",
            "format": "float",
            "description": "Product price",
            "example": 399.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (ISO 4217)",
            "default": "USD",
            "example": "USD"
          },
          "subscription": {
            "type": "object",
            "description": "Subscription details (if recurring)",
            "properties": {
              "is_recurring": {
                "type": "boolean",
                "description": "Whether this is a recurring subscription",
                "example": true
              },
              "interval_days": {
                "type": "integer",
                "description": "Billing interval in days",
                "example": 84
              },
              "interval_label": {
                "type": "string",
                "description": "Human-readable interval description",
                "example": "every 12 weeks"
              }
            }
          },
          "active": {
            "type": "boolean",
            "description": "Whether the product is available for purchase",
            "default": true,
            "example": true
          }
        },
        "example": {
          "id": "sem_w12",
          "name": "Semaglutide Injection",
          "description": "12-week supply of injectable Semaglutide for weight management",
          "program_id": "MWL",
          "price": 399.00,
          "currency": "USD",
          "subscription": {
            "is_recurring": true,
            "interval_days": 84,
            "interval_label": "every 12 weeks"
          },
          "active": true
        }
      },
      "ProductListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["products", "pagination"],
            "properties": {
              "products": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Product"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "FunnelResponseInput": {
        "type": "object",
        "required": ["patient", "questionnaire_response", "product_id"],
        "properties": {
          "patient": {
            "$ref": "#/components/schemas/PatientInput"
          },
          "questionnaire_response": {
            "type": "object",
            "required": ["questionnaire_id", "answers"],
            "properties": {
              "questionnaire_id": {
                "type": "string",
                "description": "Questionnaire ID"
              },
              "answers": {
                "type": "object",
                "additionalProperties": true,
                "description": "Questionnaire answers (question_id: answer)"
              }
            }
          },
          "product_id": {
            "type": "string",
            "description": "Product ID for the order"
          }
        },
        "example": {
          "patient": {
            "email": "john.doe@example.com",
            "first_name": "John",
            "last_name": "Doe",
            "phone": "+1-555-0123",
            "birth_date": "1990-05-15",
            "gender": "male",
            "sex": "male",
            "locations": [{
              "address_line_1": "123 Main Street",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }]
          },
          "questionnaire_response": {
            "questionnaire_id": "quest_123",
            "answers": {
              "q1": "180",
              "q2": "Yes"
            }
          },
          "product_id": "sem_w12"
        }
      },
      "FunnelResponseOutput": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["patient_id", "questionnaire_response_id"],
            "properties": {
              "patient_id": {
                "type": "string",
                "description": "Created patient ID"
              },
              "questionnaire_response_id": {
                "type": "string",
                "description": "Created questionnaire response ID"
              },
              "invoice_ids": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Created invoice IDs"
              },
              "order_id": {
                "type": "string",
                "description": "Created order ID"
              }
            }
          }
        }
      },
      "Order": {
        "type": "object",
        "required": ["id", "patient_id", "product_id", "status", "total_amount"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Order ID"
          },
          "organization_id": {
            "type": "string",
            "description": "Organization ID"
          },
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "program_id": {
            "type": "string",
            "description": "Program ID"
          },
          "product_id": {
            "type": "string",
            "description": "Product ID"
          },
          "questionnaire_response_id": {
            "type": "string",
            "description": "Associated questionnaire response ID"
          },
          "status": {
            "type": "string",
            "enum": ["pending_payment", "paid", "pending_review", "approved", "rejected", "fulfilling", "fulfilled", "active", "cancelled", "on_hold"],
            "description": "Order status"
          },
          "payment_status": {
            "type": "string",
            "enum": ["pending", "paid", "failed", "refunded", "partially_refunded"],
            "description": "Payment status"
          },
          "clinical_status": {
            "type": "object",
            "properties": {
              "eligibility_check": {
                "type": "string",
                "enum": ["passed", "failed", "pending"],
                "description": "Eligibility check result"
              },
              "risk_level": {
                "type": "string",
                "enum": ["low", "medium", "high"],
                "description": "Clinical risk level"
              },
              "requires_sync_consult": {
                "type": "boolean",
                "description": "Whether synchronous consultation is required"
              },
              "approval_status": {
                "type": "string",
                "enum": ["pending_provider_review", "approved", "rejected", "needs_more_info"],
                "description": "Provider approval status"
              }
            }
          },
          "labs": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LabOrder"
            },
            "description": "Associated lab orders"
          },
          "review": {
            "type": "object",
            "properties": {
              "assigned_provider_id": {
                "type": "string",
                "description": "ID of assigned provider"
              },
              "assigned_at": {
                "type": "string",
                "format": "date-time",
                "description": "When provider was assigned"
              },
              "reviewed_at": {
                "type": "string",
                "format": "date-time",
                "description": "When review was completed"
              },
              "decision": {
                "type": "string",
                "enum": ["approved", "rejected", "needs_more_info"],
                "description": "Provider decision"
              },
              "provider_notes": {
                "type": "string",
                "description": "Internal provider notes"
              },
              "patient_facing_notes": {
                "type": "string",
                "description": "Notes visible to patient"
              },
              "requires_sync_consult": {
                "type": "boolean",
                "description": "Whether sync consultation is required"
              },
              "consult_scheduled_at": {
                "type": "string",
                "format": "date-time",
                "description": "Scheduled consultation time"
              }
            }
          },
          "fulfillment": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "enum": ["not_started", "processing", "shipped", "delivered", "failed"],
                "description": "Fulfillment status"
              },
              "pharmacy_id": {
                "type": "string",
                "description": "Pharmacy ID"
              },
              "tracking_number": {
                "type": "string",
                "description": "Shipment tracking number"
              },
              "carrier": {
                "type": "string",
                "description": "Shipping carrier"
              },
              "shipped_at": {
                "type": "string",
                "format": "date-time",
                "description": "Shipment timestamp"
              },
              "estimated_delivery": {
                "type": "string",
                "format": "date-time",
                "description": "Estimated delivery date"
              },
              "delivered_at": {
                "type": "string",
                "format": "date-time",
                "description": "Actual delivery timestamp"
              }
            }
          },
          "pricing": {
            "type": "object",
            "properties": {
              "subtotal": {
                "type": "integer",
                "description": "Subtotal in cents"
              },
              "shipping": {
                "type": "integer",
                "description": "Shipping cost in cents"
              },
              "tax": {
                "type": "integer",
                "description": "Tax amount in cents"
              },
              "discount": {
                "type": "integer",
                "description": "Discount amount in cents"
              },
              "total": {
            "type": "integer",
            "description": "Total amount in cents"
          },
          "currency": {
            "type": "string",
            "description": "Currency code",
            "default": "USD"
              }
            }
          },
          "subscription": {
            "type": "object",
            "properties": {
              "is_subscription": {
                "type": "boolean",
                "description": "Whether this is a subscription order"
              },
              "subscription_id": {
                "type": "string",
                "description": "External subscription ID (e.g., Stripe subscription)"
              },
              "next_billing_date": {
                "type": "string",
                "format": "date-time",
                "description": "Next billing date"
              },
              "auto_renew": {
                "type": "boolean",
                "description": "Whether auto-renewal is enabled"
              }
            }
          },
          "total_amount": {
            "type": "integer",
            "description": "Total amount in cents (deprecated, use pricing.total)"
          },
          "currency": {
            "type": "string",
            "description": "Currency code (deprecated, use pricing.currency)",
            "default": "USD"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "Additional metadata (payment IDs, campaign info, etc.)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        },
        "example": {
          "id": "ord_7b12f9c8-5340-4b0f-bef3",
          "organization_id": "org_mwl_partner_001",
          "patient_id": "pat_9f4c2b1e-8c3d-4b0f",
          "program_id": "MWL",
          "product_id": "sem_w12",
          "questionnaire_response_id": "qr_abc123",
          "status": "pending_review",
          "payment_status": "paid",
          "clinical_status": {
            "eligibility_check": "passed",
            "risk_level": "low",
            "requires_sync_consult": false,
            "approval_status": "pending_provider_review"
          },
          "labs": [
            {
              "id": "labord_001",
              "lab_id": "lab_total_testosterone",
              "lab_name": "Total Testosterone",
              "status": "ordered"
            }
          ],
          "review": {
            "assigned_provider_id": "prov_1234",
            "assigned_at": "2025-01-11T14:20:00Z",
            "reviewed_at": null,
            "decision": null,
            "provider_notes": null,
            "patient_facing_notes": null,
            "requires_sync_consult": false,
            "consult_scheduled_at": null
          },
          "fulfillment": {
            "status": "not_started",
            "pharmacy_id": null,
            "tracking_number": null,
            "carrier": null
          },
          "pricing": {
            "subtotal": 19900,
            "shipping": 0,
            "tax": 0,
            "discount": 0,
            "total": 19900,
            "currency": "USD"
          },
          "subscription": {
            "is_subscription": true,
            "subscription_id": "sub_stripe_xyz",
            "next_billing_date": "2025-02-11T14:15:00Z",
            "auto_renew": true
          },
          "metadata": {
            "external_payment_intent_id": "pi_3Qxxxxxx",
            "campaign": "new_year_promo_2025"
          },
          "created_at": "2025-01-11T14:15:00Z",
          "updated_at": "2025-01-11T14:20:00Z"
        }
      },
      "OrderInput": {
        "type": "object",
        "required": ["patient_id", "product_id"],
        "properties": {
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "program_id": {
            "type": "string",
            "description": "Program ID"
          },
          "product_id": {
            "type": "string",
            "description": "Product ID"
          },
          "questionnaire_response_id": {
            "type": "string",
            "description": "Questionnaire response ID"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "Additional metadata (campaign info, partner IDs, etc.)"
          }
        },
        "example": {
          "patient_id": "pat_xyz789",
          "program_id": "MWL",
          "product_id": "sem_w12",
          "questionnaire_response_id": "qr_ghi789",
          "metadata": {
            "campaign": "new_year_promo_2025",
            "utm_source": "partner_referral"
          }
        }
      },
      "OrderUpdateInput": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["pending_payment", "paid", "pending_review", "approved", "rejected", "fulfilling", "fulfilled", "active", "cancelled", "on_hold"],
            "description": "Order status"
          },
          "payment_status": {
            "type": "string",
            "enum": ["pending", "paid", "failed", "refunded", "partially_refunded"],
            "description": "Payment status"
          },
          "review": {
            "type": "object",
            "properties": {
              "assigned_provider_id": {
                "type": "string"
              },
              "decision": {
                "type": "string",
                "enum": ["approved", "rejected", "needs_more_info"]
              },
              "provider_notes": {
                "type": "string"
              },
              "patient_facing_notes": {
                "type": "string"
              }
            }
          },
          "fulfillment": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "enum": ["not_started", "processing", "shipped", "delivered", "failed"]
              },
              "pharmacy_id": {
                "type": "string"
              },
              "tracking_number": {
                "type": "string"
              },
              "carrier": {
                "type": "string"
              },
              "shipped_at": {
                "type": "string",
                "format": "date-time"
              },
              "estimated_delivery": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "example": {
          "status": "approved",
          "fulfillment": {
            "status": "shipped",
            "tracking_number": "1Z999AA10123456784",
            "carrier": "UPS",
            "shipped_at": "2025-01-15T14:00:00Z"
          }
        }
      },
      "OrderResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["order"],
            "properties": {
              "order": {
                "$ref": "#/components/schemas/Order"
              }
            }
          }
        }
      },
      "OrderListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["orders", "pagination"],
            "properties": {
              "orders": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Order"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "Document": {
        "type": "object",
        "required": ["id", "patient_id", "type", "status", "uploaded_at"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Document ID"
          },
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "type": {
            "type": "string",
            "enum": ["drivers_license", "passport", "state_id", "insurance_card", "other"],
            "description": "Document type"
          },
          "document_number": {
            "type": "string",
            "description": "Document number (e.g., license number, passport number)"
          },
          "issuing_state": {
            "type": "string",
            "description": "Issuing state (for US documents)"
          },
          "issuing_country": {
            "type": "string",
            "description": "Issuing country (2-letter code)"
          },
          "expiration_date": {
            "type": "string",
            "format": "date",
            "description": "Document expiration date"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "verified", "rejected", "expired"],
            "description": "Document verification status"
          },
          "verified": {
            "type": "boolean",
            "description": "Whether the document has been verified"
          },
          "verified_by": {
            "type": "string",
            "description": "ID of user who verified the document"
          },
          "verified_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when document was verified"
          },
          "file_url": {
            "type": "string",
            "description": "Secure URL to access the document file"
          },
          "file_type": {
            "type": "string",
            "description": "File MIME type (e.g., image/jpeg, application/pdf)"
          },
          "notes": {
            "type": "string",
            "description": "Verification notes or additional information"
          },
          "uploaded_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when document was uploaded"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of last update"
          }
        },
        "example": {
          "id": "doc_abc123",
          "patient_id": "pat_xyz789",
          "type": "drivers_license",
          "document_number": "D1234567",
          "issuing_state": "CA",
          "issuing_country": "US",
          "expiration_date": "2028-05-15",
          "status": "verified",
          "verified": true,
          "verified_by": "admin_001",
          "verified_at": "2025-01-12T10:00:00Z",
          "file_url": "https://secure.openloop.com/documents/doc_abc123.pdf",
          "file_type": "application/pdf",
          "notes": "Document verified successfully",
          "uploaded_at": "2025-01-11T14:30:00Z",
          "updated_at": "2025-01-12T10:00:00Z"
        }
      },
      "DocumentInput": {
        "type": "object",
        "required": ["patient_id", "type", "file_url"],
        "properties": {
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "type": {
            "type": "string",
            "enum": ["drivers_license", "passport", "state_id", "insurance_card", "other"],
            "description": "Document type"
          },
          "document_number": {
            "type": "string",
            "description": "Document number"
          },
          "issuing_state": {
            "type": "string",
            "description": "Issuing state (for US documents)"
          },
          "issuing_country": {
            "type": "string",
            "description": "Issuing country (2-letter code)"
          },
          "expiration_date": {
            "type": "string",
            "format": "date",
            "description": "Document expiration date"
          },
          "file_url": {
            "type": "string",
            "description": "URL to the uploaded document file"
          },
          "file_type": {
            "type": "string",
            "description": "File MIME type"
          },
          "notes": {
            "type": "string",
            "description": "Additional notes"
          }
        },
        "example": {
          "patient_id": "pat_xyz789",
          "type": "drivers_license",
          "document_number": "D1234567",
          "issuing_state": "CA",
          "issuing_country": "US",
          "expiration_date": "2028-05-15",
          "file_url": "https://secure.openloop.com/documents/temp_upload.pdf",
          "file_type": "application/pdf"
        }
      },
      "DocumentUpdateInput": {
        "type": "object",
        "properties": {
          "document_number": {
            "type": "string",
            "description": "Document number"
          },
          "issuing_state": {
            "type": "string",
            "description": "Issuing state"
          },
          "issuing_country": {
            "type": "string",
            "description": "Issuing country"
          },
          "expiration_date": {
            "type": "string",
            "format": "date",
            "description": "Document expiration date"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "verified", "rejected", "expired"],
            "description": "Document status"
          },
          "verified": {
            "type": "boolean",
            "description": "Whether the document has been verified"
          },
          "verified_by": {
            "type": "string",
            "description": "ID of user who verified the document"
          },
          "notes": {
            "type": "string",
            "description": "Verification notes or additional information"
          }
        },
        "example": {
          "verified": true,
          "verified_by": "admin_001",
          "status": "verified",
          "notes": "Document verified successfully"
        }
      },
      "DocumentResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["document"],
            "properties": {
              "document": {
                "$ref": "#/components/schemas/Document"
              }
            }
          }
        }
      },
      "DocumentListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["documents"],
            "properties": {
              "documents": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Document"
                }
              }
            }
          }
        }
      },
      "LabOrder": {
        "type": "object",
        "required": ["id", "patient_id", "lab_id", "status"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Lab order ID"
          },
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "order_id": {
            "type": "string",
            "description": "Associated order ID (if part of an order)"
          },
          "lab_id": {
            "type": "string",
            "description": "Lab test identifier (e.g., lab_total_testosterone)"
          },
          "lab_name": {
            "type": "string",
            "description": "Human-readable lab test name"
          },
          "status": {
            "type": "string",
            "enum": ["ordered", "received", "completed", "reviewed", "cancelled"],
            "description": "Lab order status"
          },
          "ordered_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when lab was ordered"
          },
          "collected_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when sample was collected"
          },
          "results_received_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when results were received"
          },
          "reviewed_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when results were reviewed by provider"
          },
          "value": {
            "type": "string",
            "description": "Lab result value"
          },
          "unit": {
            "type": "string",
            "description": "Unit of measurement (e.g., ng/dL, mg/L)"
          },
          "reference_range": {
            "type": "object",
            "properties": {
              "min": {
                "type": "number",
                "description": "Minimum reference value"
              },
              "max": {
                "type": "number",
                "description": "Maximum reference value"
              }
            }
          },
          "in_range": {
            "type": "boolean",
            "description": "Whether the result is within normal range"
          },
          "flag": {
            "type": "string",
            "enum": ["normal", "low", "high", "critical"],
            "description": "Result flag"
          },
          "notes": {
            "type": "string",
            "description": "Provider notes or additional information"
          },
          "lab_provider": {
            "type": "string",
            "description": "Lab provider name (e.g., Quest, LabCorp)"
          },
          "requisition_number": {
            "type": "string",
            "description": "Lab requisition number"
          },
          "file_url": {
            "type": "string",
            "description": "URL to lab results PDF"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        },
        "example": {
          "id": "labord_abc123",
          "patient_id": "pat_xyz789",
          "order_id": "ord_def456",
          "lab_id": "lab_total_testosterone",
          "lab_name": "Total Testosterone",
          "status": "completed",
          "ordered_at": "2025-01-11T14:15:00Z",
          "collected_at": "2025-01-13T09:00:00Z",
          "results_received_at": "2025-01-14T16:30:00Z",
          "reviewed_at": "2025-01-14T17:00:00Z",
          "value": "350",
          "unit": "ng/dL",
          "reference_range": {
            "min": 300,
            "max": 1000
          },
          "in_range": true,
          "flag": "normal",
          "notes": "Results within normal range",
          "lab_provider": "Quest Diagnostics",
          "requisition_number": "REQ123456",
          "file_url": "https://secure.openloop.com/labs/labord_abc123.pdf",
          "created_at": "2025-01-11T14:15:00Z",
          "updated_at": "2025-01-14T17:00:00Z"
        }
      },
      "LabOrderInput": {
        "type": "object",
        "required": ["patient_id", "lab_id"],
        "properties": {
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "order_id": {
            "type": "string",
            "description": "Associated order ID"
          },
          "lab_id": {
            "type": "string",
            "description": "Lab test identifier"
          },
          "lab_provider": {
            "type": "string",
            "description": "Preferred lab provider"
          },
          "notes": {
            "type": "string",
            "description": "Additional notes"
          }
        },
        "example": {
          "patient_id": "pat_xyz789",
          "order_id": "ord_def456",
          "lab_id": "lab_total_testosterone",
          "lab_provider": "Quest Diagnostics",
          "notes": "Fasting required"
        }
      },
      "LabOrderUpdateInput": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["ordered", "received", "completed", "reviewed", "cancelled"],
            "description": "Lab order status"
          },
          "collected_at": {
            "type": "string",
            "format": "date-time",
            "description": "Sample collection timestamp"
          },
          "results_received_at": {
            "type": "string",
            "format": "date-time",
            "description": "Results received timestamp"
          },
          "reviewed_at": {
            "type": "string",
            "format": "date-time",
            "description": "Results reviewed timestamp"
          },
          "value": {
            "type": "string",
            "description": "Lab result value"
          },
          "unit": {
            "type": "string",
            "description": "Unit of measurement"
          },
          "reference_range": {
            "type": "object",
            "properties": {
              "min": {
                "type": "number"
              },
              "max": {
                "type": "number"
              }
            }
          },
          "in_range": {
            "type": "boolean",
            "description": "Whether result is within range"
          },
          "flag": {
            "type": "string",
            "enum": ["normal", "low", "high", "critical"],
            "description": "Result flag"
          },
          "file_url": {
            "type": "string",
            "description": "URL to lab results file"
          },
          "notes": {
            "type": "string",
            "description": "Additional notes"
          }
        },
        "example": {
          "status": "completed",
          "value": "350",
          "unit": "ng/dL",
          "reference_range": {
            "min": 300,
            "max": 1000
          },
          "flag": "normal",
          "in_range": true,
          "results_received_at": "2025-01-14T16:30:00Z",
          "notes": "Results within normal range"
        }
      },
      "LabOrderResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["lab_order"],
            "properties": {
              "lab_order": {
                "$ref": "#/components/schemas/LabOrder"
              }
            }
          }
        }
      },
      "LabOrderListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["lab_orders"],
            "properties": {
              "lab_orders": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/LabOrder"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "QuestionnaireResponseSubmitted": {
        "type": "object",
        "required": ["id", "patient_id", "questionnaire_id", "answers"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Questionnaire response ID"
          },
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "questionnaire_id": {
            "type": "string",
            "description": "Questionnaire ID"
          },
          "program_id": {
            "type": "string",
            "description": "Program ID"
          },
          "answers": {
            "type": "object",
            "additionalProperties": true,
            "description": "Question answers (question_id: answer)"
          },
          "status": {
            "type": "string",
            "enum": ["completed", "in_progress"],
            "description": "Response status"
          },
          "risk_assessment": {
            "type": "object",
            "description": "Automated risk assessment based on responses (calculated internally)",
            "properties": {
              "eligible": {
                "type": "boolean",
                "description": "Whether patient is eligible for the program"
              },
              "risk_level": {
                "type": "string",
                "enum": ["low", "medium", "high"],
                "description": "Calculated risk level"
              },
              "requires_sync_consult": {
                "type": "boolean",
                "description": "Whether synchronous consultation with provider is required"
              },
              "requires_clearance": {
                "type": "boolean",
                "description": "Whether clearance from PCP or specialist is required"
              },
              "exclusion_reason": {
                "type": "string",
                "nullable": true,
                "description": "Reason for exclusion if not eligible (e.g., 'medical_exclusion_criteria', 'bmi', etc.)"
              },
              "sync_visit_reason": {
                "type": "string",
                "nullable": true,
                "description": "Reason sync consult is needed (e.g., 'bmi', 'other_exclusion_conditions')"
              },
              "next_step": {
                "type": "string",
                "enum": ["allow_async_order", "require_sync_consult", "require_clearance", "exclude"],
                "description": "Recommended next step in the workflow"
              }
            }
          },
          "calculated_fields": {
            "type": "object",
            "description": "Fields calculated by the backend (not submitted by user)",
            "properties": {
              "bmi": {
                "type": "number",
                "format": "float",
                "description": "Calculated Body Mass Index"
              },
              "age": {
                "type": "integer",
                "description": "Calculated age from date of birth"
              },
              "height": {
                "type": "integer",
                "description": "Calculated total height in inches"
              },
              "comorbidity_required": {
                "type": "boolean",
                "description": "Whether comorbidity is required for eligibility (BMI 25-26.99)"
              }
            }
          },
          "completed_at": {
            "type": "string",
            "format": "date-time",
            "description": "When questionnaire was completed"
          },
          "reviewed_by": {
            "type": "string",
            "description": "Provider ID who reviewed (if applicable)"
          },
          "reviewed_at": {
            "type": "string",
            "format": "date-time",
            "description": "When response was reviewed"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        },
        "example": {
          "id": "qr_abc123",
          "patient_id": "pat_xyz789",
          "questionnaire_id": "q_mwl_intake_v1",
          "program_id": "MWL",
          "status": "completed",
          "answers": {
            "weight_goal": "lose_21-50_lbs",
            "height_feet": 5,
            "height_inches": 5,
            "weight": 160,
            "gender": "female",
            "date_of_birth": "1990-01-01",
            "state": "AL",
            "main_reason": "health_risks",
            "medical_exclusion_criteria": ["none"],
            "prior_weight_loss_meds_use": "no",
            "any_medications": "no",
            "medication_allergies": "no",
            "blood_pressure_range": "normal"
          },
          "risk_assessment": {
            "eligible": true,
            "risk_level": "low",
            "requires_sync_consult": false,
            "requires_clearance": false,
            "exclusion_reason": null,
            "sync_visit_reason": null,
            "next_step": "allow_async_order"
          },
          "calculated_fields": {
            "bmi": 26.62,
            "age": 35,
            "height": 65,
            "comorbidity_required": true
          },
          "completed_at": "2025-01-15T14:30:00Z",
          "reviewed_by": null,
          "reviewed_at": null,
          "created_at": "2025-01-15T14:25:00Z",
          "updated_at": "2025-01-15T14:30:00Z"
        }
      },
      "QuestionnaireResponseInput": {
        "type": "object",
        "required": ["patient_id", "questionnaire_id", "answers"],
        "properties": {
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "questionnaire_id": {
            "type": "string",
            "description": "Questionnaire ID"
          },
          "program_id": {
            "type": "string",
            "description": "Program ID (optional if questionnaire already linked)"
          },
          "answers": {
            "type": "object",
            "additionalProperties": true,
            "description": "Question answers as key-value pairs (link_id: answer_value). Only submit answers for questions with read_only=false. Do NOT submit calculated fields (read_only=true) like bmi, age, height - these are computed by the backend."
          }
        },
        "example": {
          "patient_id": "pat_xyz789",
          "questionnaire_id": "q_mwl_intake_v1",
          "program_id": "MWL",
          "answers": {
            "weight_goal": "lose_21-50_lbs",
            "height_feet": 5,
            "height_inches": 5,
            "weight": 160,
            "gender": "female",
            "date_of_birth": "1990-01-01",
            "state": "AL",
            "main_reason": "health_risks",
            "medical_exclusion_criteria": ["none"],
            "prior_weight_loss_meds_use": "no",
            "any_medications": "no",
            "medication_allergies": "no",
            "blood_pressure_range": "normal"
          }
        }
      },
      "QuestionnaireResponseSubmitResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["questionnaire_response"],
            "properties": {
              "questionnaire_response": {
                "$ref": "#/components/schemas/QuestionnaireResponseSubmitted"
              }
            }
          }
        }
      },
      "QuestionnaireResponseListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["questionnaire_responses"],
            "properties": {
              "questionnaire_responses": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/QuestionnaireResponseSubmitted"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Unauthorized - Invalid or missing authentication",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "unauthorized": {
                "summary": "Unauthorized",
                "value": {
                  "error": "Unauthorized",
                  "message": "Authentication token missing or invalid"
                }
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Not Found - Resource does not exist",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "not_found": {
                "summary": "Resource Not Found",
                "value": {
                  "error": "NotFound",
                  "message": "Resource not found"
                }
              }
            }
          }
        }
      },
      "ValidationError": {
        "description": "Bad Request - Validation error or invalid data",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "validation_error": {
                "summary": "Validation Error",
                "value": {
                  "error": "ValidationError",
                  "message": "Invalid input data",
                  "details": [
                    {
                      "field": "email",
                      "issue": "Invalid email format"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "x-api-key",
        "description": "API key authentication"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Bearer token authentication"
      }
    }
  }
}

