{
  "openapi": "3.1.0",
  "info": {
    "title": "Partners API",
    "description": "Partners API v1 - Patient management endpoints. This version focuses exclusively on patient operations.",
    "license": {
      "name": "MIT"
    },
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://api-staging.openloophealth.com",
      "description": "Staging server"
    }
  ],
  "security": [
    {
      "apiKeyAuth": []
    },
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Health check endpoint",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Service health information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["name", "version_date"],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "version_date": {
                      "type": "string",
                      "format": "date-time",
                      "description": "Version date in ISO 8601 format"
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Health check response",
                    "value": {
                      "name": "partners-api",
                      "version_date": "2025-11-21T16:51:50.139Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/patients": {
      "get": {
        "summary": "List Patients",
        "description": "List all patients with optional filtering and pagination",
        "tags": ["Patients"],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Search query to filter patients by email, firstName, lastName, or phone",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of patients",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create Patient",
        "description": "Create a new patient",
        "tags": ["Patients"],
        "requestBody": {
          "description": "Patient data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PatientInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Patient created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Validation error or invalid data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "validation_error": {
                    "summary": "Validation Error",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/patients/{id}": {
      "get": {
        "summary": "Get Patient",
        "description": "Get a specific patient by ID",
        "tags": ["Patients"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Patient found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Patient does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "not_found": {
                    "summary": "Patient Not Found",
                    "value": {
                      "error": "NotFound",
                      "message": "Resource not found"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update Patient",
        "description": "Update a patient",
        "tags": ["Patients"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Updated patient data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PatientInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Patient updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PatientResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Patient does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "not_found": {
                    "summary": "Patient Not Found",
                    "value": {
                      "error": "NotFound",
                      "message": "Resource not found"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "unauthorized": {
                    "summary": "Unauthorized",
                    "value": {
                      "error": "Unauthorized",
                      "message": "Authentication token missing or invalid"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity - Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "payment_required": {
                    "summary": "Payment Required",
                    "value": {
                      "error": "ValidationError",
                      "message": "Invalid input data",
                      "details": [
                        {
                          "field": "email",
                          "issue": "Invalid email format"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete Patient",
        "description": "Delete a patient",
        "tags": ["Patients"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Patient ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Patient deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/programs": {
      "get": {
        "summary": "List Programs",
        "description": "Get all available clinical vertical programs (BH, DERM, SLEEP, etc.)",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "bundle_code",
            "in": "query",
            "description": "Filter by clinical vertical bundle code",
            "schema": {
              "type": "string",
              "enum": ["BH", "DERM", "SLEEP", "SH", "ACUTE", "CCRM", "MWL", "WELLNESS", "SUPPORT", "NOMED"]
            }
          },
          {
            "name": "gender",
            "in": "query",
            "description": "Filter by gender (M, F, ALL)",
            "schema": {
              "type": "string",
              "enum": ["M", "F", "ALL"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Programs retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgramListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Programs list example",
                    "value": {
                      "message": "Programs retrieved successfully",
                      "data": {
                        "programs": [
                          {
                            "id": "ADHD",
                            "name": "ADHD",
                            "bundle_code": "BH",
                            "bundle_name": "Behavioral Health",
                            "offering_name": "ADHD",
                            "age_range": null,
                            "gender": null
                          },
                          {
                            "id": "MHL",
                            "name": "Men's hair loss",
                            "bundle_code": "DERM",
                            "bundle_name": "Hair & Dermatologic Health",
                            "offering_name": "Men's hair loss",
                            "age_range": null,
                            "gender": "M"
                          }
                        ]
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/programs/{programId}": {
      "get": {
        "summary": "Get Program",
        "description": "Retrieve details of a specific program by its abbreviation ID",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "programId",
            "in": "path",
            "description": "Program abbreviation (e.g., ADHD, MHL, ED)",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Program retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgramResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Program example",
                    "value": {
                      "message": "Program retrieved successfully",
                      "data": {
                        "program": {
                          "id": "ADHD",
                          "name": "ADHD",
                          "bundle_code": "BH",
                          "bundle_name": "Behavioral Health",
                          "offering_name": "ADHD",
                          "age_range": null,
                          "gender": null
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/programs/{programId}/questionnaires": {
      "get": {
        "summary": "Get Program Questionnaire",
        "description": "Retrieve the questionnaire required for a specific program",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "programId",
            "in": "path",
            "description": "Program ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Questionnaire retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionnaireResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Questionnaire example",
                    "value": {
                      "message": "Questionnaire retrieved successfully",
                      "data": {
                        "questionnaire": {
                          "id": "quest_1a2b3c4d",
                          "program_id": "prog_123",
                          "title": "Weight Loss Program Assessment",
                          "questions": [
                            {
                              "id": "q1",
                              "text": "What is your current weight?",
                              "type": "number",
                              "required": true
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/programs/{programId}/products": {
      "get": {
        "summary": "Get Program Products",
        "description": "Get all products associated with a specific program",
        "tags": ["Programs"],
        "parameters": [
          {
            "name": "programId",
            "in": "path",
            "description": "Program abbreviation (e.g., ADHD, MHL, ED)",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Products retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductListResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/products": {
      "get": {
        "summary": "List Products",
        "description": "Get all available products with optional filtering by program, payment provider, or client",
        "tags": ["Products"],
        "parameters": [
          {
            "name": "program_id",
            "in": "query",
            "description": "Filter by program abbreviation (ADHD, MHL, ED, etc.)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "payment_provider",
            "in": "query",
            "description": "Filter by payment provider",
            "schema": {
              "type": "string",
              "enum": ["stripe", "chargebee"]
            }
          },
          {
            "name": "active",
            "in": "query",
            "description": "Filter by active status",
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results to return",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Products retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Products list example",
                    "value": {
                      "message": "Products retrieved successfully",
                      "data": {
                        "products": [
                          {
                            "product_id": "openloop_adhd_monthly_001",
                            "payment_provider_product_id": "prod_StripeABC123XYZ",
                            "payment_provider_price_id": "price_1234567890abcdef",
                            "product_name": "ADHD Treatment - Monthly Subscription",
                            "product_description": "Comprehensive ADHD treatment with medication and monthly provider consultations",
                            "price": 299.00,
                            "price_currency": "USD",
                            "payment_provider": "stripe",
                            "program_id": "ADHD",
                            "billing_frequency": "monthly",
                            "active": true
                          }
                        ],
                        "pagination": {
                          "total": 1,
                          "limit": 50,
                          "offset": 0,
                          "has_more": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/funnel-responses": {
      "post": {
        "summary": "Create Funnel Response",
        "description": "Create a patient, questionnaire response, and invoices in one operation",
        "tags": ["Funnel Responses"],
        "requestBody": {
          "description": "Funnel response data including patient info and questionnaire answers",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FunnelResponseInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Funnel response created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FunnelResponseOutput"
                },
                "examples": {
                  "success": {
                    "summary": "Funnel response created",
                    "value": {
                      "message": "Funnel response created successfully",
                      "data": {
                        "patient_id": "pat_1a2b3c4d",
                        "questionnaire_response_id": "qr_xyz789",
                        "invoice_ids": ["inv_001", "inv_002"]
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/orders": {
      "get": {
        "summary": "List Orders",
        "description": "Retrieve all orders with optional filtering",
        "tags": ["Orders"],
        "parameters": [
          {
            "name": "patient_id",
            "in": "query",
            "description": "Filter by patient ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "product_id",
            "in": "query",
            "description": "Filter by product ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by order status",
            "schema": {
              "type": "string",
              "enum": ["pending", "confirmed", "completed", "cancelled"]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of results to skip",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Orders retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderListResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Orders list",
                    "value": {
                      "message": "Orders retrieved successfully",
                      "data": {
                        "orders": [
                          {
                            "id": "ord_abc123",
                            "patient_id": "pat_xyz789",
                            "product_id": "prod_def456",
                            "status": "confirmed",
                            "total_amount": 29900,
                            "created_at": "2024-12-02T10:30:00Z"
                          }
                        ],
                        "pagination": {
                          "total": 1,
                          "limit": 50,
                          "offset": 0,
                          "has_more": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "post": {
        "summary": "Create Order",
        "description": "Create a new order based on patient, product, and questionnaire",
        "tags": ["Orders"],
        "requestBody": {
          "description": "Order data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Order created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Order created",
                    "value": {
                      "message": "Order created successfully",
                      "data": {
                        "order": {
                          "id": "ord_abc123",
                          "patient_id": "pat_xyz789",
                          "product_id": "prod_def456",
                          "status": "pending",
                          "total_amount": 29900,
                          "created_at": "2024-12-02T10:30:00Z"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/orders/{id}": {
      "get": {
        "summary": "Get Order",
        "description": "Retrieve a specific order by ID",
        "tags": ["Orders"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "put": {
        "summary": "Update Order",
        "description": "Update an existing order",
        "tags": ["Orders"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Updated order data",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderUpdateInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Order updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "delete": {
        "summary": "Delete Order",
        "description": "Delete an order by ID",
        "tags": ["Orders"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Order ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Order deleted successfully"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Patient": {
        "type": "object",
        "required": [
          "id",
          "email",
          "first_name",
          "last_name",
          "phone",
          "birth_date",
          "sex"
        ],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique patient identifier"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Patient's email address",
            "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          },
          "first_name": {
            "type": "string",
            "description": "Patient's first name",
            "minLength": 1
          },
          "middle_name": {
            "type": "string",
            "nullable": true,
            "description": "Patient's middle name"
          },
          "last_name": {
            "type": "string",
            "description": "Patient's last name",
            "minLength": 1
          },
          "phone": {
            "type": "string",
            "description": "Patient's phone number",
            "pattern": "^[\\d\\s\\-\\(\\)\\+]+$",
            "minLength": 5
          },
          "birth_date": {
            "type": "string",
            "format": "date",
            "description": "Patient's birth date in YYYY-MM-DD format",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "enum": ["male", "female", "other"],
            "description": "Patient's gender identity"
          },
          "sex": {
            "type": "string",
            "enum": ["male", "female", "other", "unknown"],
            "description": "Patient's biological sex"
          },
          "preferred_language": {
            "type": "string",
            "nullable": true,
            "description": "Patient's preferred language"
          },
          "locations": {
            "type": "array",
            "nullable": true,
            "items": {
              "$ref": "#/components/schemas/Location"
            },
            "description": "Patient's addresses"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Tag"
            },
            "description": "Patient tags for categorization"
          }
        },
        "example": {
          "id": "pat_1a2b3c4d5e6f",
          "email": "john.doe@example.com",
          "first_name": "John",
          "middle_name": "Michael",
          "last_name": "Doe",
          "phone": "+1-555-0123",
          "birth_date": "1990-05-15",
          "gender": "male",
          "sex": "male",
          "preferred_language": "en",
          "locations": [
            {
              "address_line_1": "123 Main Street",
              "address_line_2": "Apt 4B",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }
          ],
          "tags": [
            {
              "type": "employer",
              "name": "TechCorp"
            }
          ]
        }
      },
      "PatientInput": {
        "type": "object",
        "required": [
          "email",
          "first_name",
          "last_name",
          "phone",
          "birth_date",
          "gender",
          "sex",
          "locations"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Patient's email address",
            "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          },
          "first_name": {
            "type": "string",
            "description": "Patient's first name",
            "minLength": 1
          },
          "middle_name": {
            "type": "string",
            "nullable": true,
            "description": "Patient's middle name"
          },
          "last_name": {
            "type": "string",
            "description": "Patient's last name",
            "minLength": 1
          },
          "phone": {
            "type": "string",
            "description": "Patient's phone number",
            "pattern": "^[\\d\\s\\-\\(\\)\\+]+$",
            "minLength": 5
          },
          "birth_date": {
            "type": "string",
            "format": "date",
            "description": "Patient's birth date in YYYY-MM-DD format",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "enum": ["male", "female", "other"],
            "description": "Patient's gender identity"
          },
          "sex": {
            "type": "string",
            "enum": ["male", "female", "other", "unknown"],
            "description": "Patient's biological sex"
          },
          "preferred_language": {
            "type": "string",
            "nullable": true,
            "description": "Patient's preferred language"
          },
          "locations": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/components/schemas/Location"
            },
            "description": "Patient's addresses"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Tag"
            },
            "description": "Patient tags for categorization"
          }
        },
        "example": {
          "email": "john.doe@example.com",
          "first_name": "John",
          "middle_name": "Michael",
          "last_name": "Doe",
          "phone": "+1-555-0123",
          "birth_date": "1990-05-15",
          "gender": "male",
          "sex": "male",
          "preferred_language": "en",
          "locations": [
            {
              "address_line_1": "123 Main Street",
              "address_line_2": "Apt 4B",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }
          ],
          "tags": [
            {
              "type": "employer",
              "name": "TechCorp"
            }
          ]
        }
      },
      "Location": {
        "type": "object",
        "required": [
          "address_line_1",
          "city",
          "state",
          "country",
          "zip_code",
          "default",
          "type"
        ],
        "properties": {
          "address_line_1": {
            "type": "string",
            "description": "Primary address line",
            "minLength": 1
          },
          "address_line_2": {
            "type": "string",
            "nullable": true,
            "description": "Secondary address line"
          },
          "city": {
            "type": "string",
            "description": "City name",
            "minLength": 1
          },
          "state": {
            "type": "string",
            "description": "State or province",
            "minLength": 1
          },
          "country": {
            "type": "string",
            "description": "Country code (2 letters)",
            "minLength": 2,
            "maxLength": 2
          },
          "zip_code": {
            "type": "string",
            "description": "ZIP or postal code",
            "minLength": 1
          },
          "default": {
            "type": "boolean",
            "description": "Whether this is the default address"
          },
          "type": {
            "type": "string",
            "enum": ["home", "work"],
            "description": "Type of address"
          }
        },
        "example": {
          "address_line_1": "123 Main Street",
          "address_line_2": "Apt 4B",
          "city": "New York",
          "state": "NY",
          "country": "US",
          "zip_code": "10001",
          "default": true,
          "type": "home"
        }
      },
      "Tag": {
        "type": "object",
        "required": [
          "type",
          "name"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["employer", "operational"],
            "description": "Type of tag"
          },
          "name": {
            "type": "string",
            "description": "Tag name",
            "minLength": 1
          }
        },
        "example": {
          "type": "employer",
          "name": "TechCorp"
        }
      },
      "Error": {
        "type": "object",
        "required": [
          "error",
          "message"
        ],
        "properties": {
          "error": {
            "type": "string",
            "description": "Error code",
            "enum": [
              "BadRequest",
              "Unauthorized",
              "Forbidden",
              "NotFound",
              "ValidationError",
              "InternalServerError",
              "ServiceUnavailable"
            ],
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error message",
            "example": "Invalid input data"
          },
          "details": {
            "type": "array",
            "description": "Array of validation error details",
            "items": {
              "type": "object",
              "required": [
                "field",
                "issue"
              ],
              "properties": {
                "field": {
                  "type": "string",
                  "description": "Field that caused the validation error",
                  "example": "email"
                },
                "issue": {
                  "type": "string",
                  "description": "Description of the validation issue",
                  "example": "Invalid email format"
                }
              }
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "required": [
          "total",
          "limit",
          "offset",
          "has_more"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "description": "Total number of items matching the query",
            "example": 13
          },
          "limit": {
            "type": "integer",
            "description": "Maximum number of items returned per page",
            "example": 10
          },
          "offset": {
            "type": "integer",
            "description": "Number of items skipped",
            "example": 0
          },
          "has_more": {
            "type": "boolean",
            "description": "Whether there are more items available",
            "example": true
          }
        }
      },
      "PatientListResponse": {
        "type": "object",
        "required": [
          "message",
          "data"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message",
            "example": "Patients retrieved successfully"
          },
          "data": {
            "type": "object",
            "required": [
              "patients",
              "pagination"
            ],
            "properties": {
              "patients": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Patient"
                },
                "description": "Array of patient objects"
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        },
        "example": {
          "message": "Patients retrieved successfully",
          "data": {
            "patients": [
              {
                "id": "pat_1a2b3c4d5e6f",
                "email": "john.doe@example.com",
                "first_name": "John",
                "middle_name": "Michael",
                "last_name": "Doe",
                "phone": "+1-555-0123",
                "birth_date": "1990-05-15",
                "gender": "male",
                "sex": "male",
                "preferred_language": "en",
                "locations": [
                  {
                    "address_line_1": "123 Main Street",
                    "address_line_2": "Apt 4B",
                    "city": "New York",
                    "state": "NY",
                    "country": "US",
                    "zip_code": "10001",
                    "default": true,
                    "type": "home"
                  }
                ],
                "tags": [
                  {
                    "type": "employer",
                    "name": "TechCorp"
                  }
                ]
              }
            ],
            "pagination": {
              "total": 1,
              "limit": 50,
              "offset": 0,
              "has_more": false
            }
          }
        }
      },
      "PatientResponse": {
        "type": "object",
        "required": [
          "message",
          "data"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message",
            "example": "Patient created successfully"
          },
          "data": {
            "type": "object",
            "required": [
              "patient"
            ],
            "properties": {
              "patient": {
                "$ref": "#/components/schemas/Patient"
              }
            }
          }
        },
        "example": {
          "message": "Patient created successfully",
          "data": {
            "patient": {
              "id": "pat_1a2b3c4d5e6f",
              "email": "john.doe@example.com",
              "first_name": "John",
              "middle_name": "Michael",
              "last_name": "Doe",
              "phone": "+1-555-0123",
              "birth_date": "1990-05-15",
              "gender": "male",
              "sex": "male",
              "preferred_language": "en",
              "locations": [
                {
                  "address_line_1": "123 Main Street",
                  "address_line_2": "Apt 4B",
                  "city": "New York",
                  "state": "NY",
                  "country": "US",
                  "zip_code": "10001",
                  "default": true,
                  "type": "home"
                }
              ],
              "tags": [
                {
                  "type": "employer",
                  "name": "TechCorp"
                }
              ]
            }
          }
        }
      },
      "Program": {
        "type": "object",
        "required": ["id", "name", "bundle_code", "bundle_name", "offering_name"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Program abbreviation ID (e.g., ADHD, MHL, ED). This is the unique identifier used across the API."
          },
          "name": {
            "type": "string",
            "description": "Program display name"
          },
          "bundle_code": {
            "type": "string",
            "enum": ["BH", "DERM", "SLEEP", "SH", "ACUTE", "CCRM", "MWL", "WELLNESS", "SUPPORT", "NOMED"],
            "description": "Clinical vertical bundle code (e.g., BH for Behavioral Health)"
          },
          "bundle_name": {
            "type": "string",
            "description": "Full bundle name for display (e.g., 'Behavioral Health', 'Hair & Dermatologic Health')"
          },
          "offering_name": {
            "type": "string",
            "description": "Clinical vertical offering name for display"
          },
          "age_range": {
            "type": "string",
            "nullable": true,
            "description": "Target age range if applicable (e.g., '18-65'). Null means no age restriction."
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "enum": ["M", "F", "ALL", null],
            "description": "Target gender restriction: M (Male only), F (Female only), ALL (any gender), null (no restriction)"
          }
        },
        "example": {
          "id": "ADHD",
          "name": "ADHD",
          "bundle_code": "BH",
          "bundle_name": "Behavioral Health",
          "offering_name": "ADHD",
          "age_range": null,
          "gender": null
        }
      },
      "ProgramListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["programs"],
            "properties": {
              "programs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Program"
                },
                "description": "List of available programs"
              }
            }
          }
        }
      },
      "ProgramResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["program"],
            "properties": {
              "program": {
                "$ref": "#/components/schemas/Program"
              }
            }
          }
        }
      },
      "Question": {
        "type": "object",
        "required": ["id", "text", "type", "required"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Question ID"
          },
          "text": {
            "type": "string",
            "description": "Question text"
          },
          "type": {
            "type": "string",
            "enum": ["text", "number", "select", "multiselect", "date"],
            "description": "Question type"
          },
          "required": {
            "type": "boolean",
            "description": "Whether the question is required"
          },
          "options": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Available options for select/multiselect questions"
          }
        }
      },
      "Questionnaire": {
        "type": "object",
        "required": ["id", "program_id", "title", "questions"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Questionnaire ID"
          },
          "program_id": {
            "type": "string",
            "description": "Associated program ID"
          },
          "title": {
            "type": "string",
            "description": "Questionnaire title"
          },
          "description": {
            "type": "string",
            "description": "Questionnaire description"
          },
          "questions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Question"
            },
            "description": "List of questions"
          }
        }
      },
      "QuestionnaireResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["questionnaire"],
            "properties": {
              "questionnaire": {
                "$ref": "#/components/schemas/Questionnaire"
              }
            }
          }
        }
      },
      "Product": {
        "type": "object",
        "required": ["product_id", "product_name", "price", "price_currency", "payment_provider"],
        "properties": {
          "product_id": {
            "type": "string",
            "description": "Internal OpenLoop product identifier (used for orders and tracking)"
          },
          "payment_provider_product_id": {
            "type": "string",
            "description": "Product ID in the payment provider system (e.g., Stripe product ID: prod_xxx, Chargebee plan ID: plan_xxx)"
          },
          "payment_provider_price_id": {
            "type": "string",
            "description": "Price ID in the payment provider system (e.g., Stripe price ID: price_xxx)"
          },
          "product_name": {
            "type": "string",
            "description": "Product display name"
          },
          "product_description": {
            "type": "string",
            "description": "Product description for display"
          },
          "price": {
            "type": "number",
            "description": "Price amount (decimal format, e.g., 299.00)"
          },
          "price_currency": {
            "type": "string",
            "description": "Currency code (ISO 4217)",
            "default": "USD"
          },
          "payment_provider": {
            "type": "string",
            "enum": ["stripe", "chargebee"],
            "description": "Payment provider system used for billing"
          },
          "program_id": {
            "type": "string",
            "description": "Associated program abbreviation (e.g., ADHD, MHL, ED)"
          },
          "billing_frequency": {
            "type": "string",
            "enum": ["one-time", "monthly", "quarterly", "annually"],
            "description": "Billing frequency for recurring charges"
          },
          "active": {
            "type": "boolean",
            "description": "Whether the product is currently active and available for purchase",
            "default": true
          }
        },
        "example": {
          "product_id": "openloop_adhd_monthly_001",
          "payment_provider_product_id": "prod_StripeABC123XYZ",
          "payment_provider_price_id": "price_1234567890abcdef",
          "product_name": "ADHD Treatment - Monthly Subscription",
          "product_description": "Comprehensive ADHD treatment with medication and monthly provider consultations",
          "price": 299.00,
          "price_currency": "USD",
          "payment_provider": "stripe",
          "program_id": "ADHD",
          "billing_frequency": "monthly",
          "active": true
        }
      },
      "ProductListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["products", "pagination"],
            "properties": {
              "products": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Product"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "FunnelResponseInput": {
        "type": "object",
        "required": ["patient", "questionnaire_response", "product_id"],
        "properties": {
          "patient": {
            "$ref": "#/components/schemas/PatientInput"
          },
          "questionnaire_response": {
            "type": "object",
            "required": ["questionnaire_id", "answers"],
            "properties": {
              "questionnaire_id": {
                "type": "string",
                "description": "Questionnaire ID"
              },
              "answers": {
                "type": "object",
                "additionalProperties": true,
                "description": "Questionnaire answers (question_id: answer)"
              }
            }
          },
          "product_id": {
            "type": "string",
            "description": "Product ID for the order"
          },
          "payment_method_id": {
            "type": "string",
            "description": "Payment method ID (e.g., Stripe payment method)"
          }
        },
        "example": {
          "patient": {
            "email": "john.doe@example.com",
            "first_name": "John",
            "last_name": "Doe",
            "phone": "+1-555-0123",
            "birth_date": "1990-05-15",
            "gender": "male",
            "sex": "male",
            "locations": [{
              "address_line_1": "123 Main Street",
              "city": "New York",
              "state": "NY",
              "country": "US",
              "zip_code": "10001",
              "default": true,
              "type": "home"
            }]
          },
          "questionnaire_response": {
            "questionnaire_id": "quest_123",
            "answers": {
              "q1": "180",
              "q2": "Yes"
            }
          },
          "product_id": "prod_abc123",
          "payment_method_id": "pm_1234567890"
        }
      },
      "FunnelResponseOutput": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["patient_id", "questionnaire_response_id"],
            "properties": {
              "patient_id": {
                "type": "string",
                "description": "Created patient ID"
              },
              "questionnaire_response_id": {
                "type": "string",
                "description": "Created questionnaire response ID"
              },
              "invoice_ids": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Created invoice IDs"
              },
              "order_id": {
                "type": "string",
                "description": "Created order ID"
              }
            }
          }
        }
      },
      "Order": {
        "type": "object",
        "required": ["id", "patient_id", "product_id", "status", "total_amount"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Order ID"
          },
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "product_id": {
            "type": "string",
            "description": "Product ID"
          },
          "questionnaire_response_id": {
            "type": "string",
            "description": "Associated questionnaire response ID"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "confirmed", "completed", "cancelled"],
            "description": "Order status"
          },
          "total_amount": {
            "type": "integer",
            "description": "Total amount in cents"
          },
          "currency": {
            "type": "string",
            "description": "Currency code",
            "default": "USD"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        },
        "example": {
          "id": "ord_abc123",
          "patient_id": "pat_xyz789",
          "product_id": "prod_def456",
          "questionnaire_response_id": "qr_ghi789",
          "status": "confirmed",
          "total_amount": 29900,
          "currency": "USD",
          "created_at": "2024-12-02T10:30:00Z",
          "updated_at": "2024-12-02T10:35:00Z"
        }
      },
      "OrderInput": {
        "type": "object",
        "required": ["patient_id", "product_id"],
        "properties": {
          "patient_id": {
            "type": "string",
            "description": "Patient ID"
          },
          "product_id": {
            "type": "string",
            "description": "Product ID"
          },
          "questionnaire_response_id": {
            "type": "string",
            "description": "Questionnaire response ID"
          }
        },
        "example": {
          "patient_id": "pat_xyz789",
          "product_id": "prod_def456",
          "questionnaire_response_id": "qr_ghi789"
        }
      },
      "OrderUpdateInput": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["pending", "confirmed", "completed", "cancelled"],
            "description": "Order status"
          }
        },
        "example": {
          "status": "confirmed"
        }
      },
      "OrderResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["order"],
            "properties": {
              "order": {
                "$ref": "#/components/schemas/Order"
              }
            }
          }
        }
      },
      "OrderListResponse": {
        "type": "object",
        "required": ["message", "data"],
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          },
          "data": {
            "type": "object",
            "required": ["orders", "pagination"],
            "properties": {
              "orders": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Order"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Unauthorized - Invalid or missing authentication",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "unauthorized": {
                "summary": "Unauthorized",
                "value": {
                  "error": "Unauthorized",
                  "message": "Authentication token missing or invalid"
                }
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Not Found - Resource does not exist",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "not_found": {
                "summary": "Resource Not Found",
                "value": {
                  "error": "NotFound",
                  "message": "Resource not found"
                }
              }
            }
          }
        }
      },
      "ValidationError": {
        "description": "Bad Request - Validation error or invalid data",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "validation_error": {
                "summary": "Validation Error",
                "value": {
                  "error": "ValidationError",
                  "message": "Invalid input data",
                  "details": [
                    {
                      "field": "email",
                      "issue": "Invalid email format"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "x-api-key",
        "description": "API key authentication"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Bearer token authentication"
      }
    }
  }
}

